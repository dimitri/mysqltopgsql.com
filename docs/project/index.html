<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>MySQL to PostgreSQL  | Project Methodology</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.31.1" />
    
    
      <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
    

    
    
      <link href="/dist/css/app.ab4b67a3ea25990fa8279f3b7ef08b61.css" rel="stylesheet">
    

    

    
      
    

    
      <link href="http://mysqltopgsql.com/project/index.xml" rel="alternate" type="application/rss+xml" title="MySQL to PostgreSQL" />
      <link href="http://mysqltopgsql.com/project/index.xml" rel="feed" type="application/rss+xml" title="MySQL to PostgreSQL" />
    

    <meta property="og:title" content="Project Methodology" />
<meta property="og:description" content="“A goal without a plan is just a wish” — Antoine de Saint-Exupéry" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://mysqltopgsql.com/project/" />














<meta itemprop="name" content="Project Methodology">
<meta itemprop="description" content="“A goal without a plan is just a wish” — Antoine de Saint-Exupéry">

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Project Methodology"/>
<meta name="twitter:description" content="“A goal without a plan is just a wish” — Antoine de Saint-Exupéry"/>

      
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-47059482-4', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

    
  </head>

  <body class="ma0 avenir bg-near-white production">

    

  
  
  <header class="cover bg-top" style="background-image: url('http://mysqltopgsql.com/img/Train_wreck_at_Montparnasse_1895.jpg');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="http://mysqltopgsql.com/" class="f3 fw2 hover-white no-underline white-90 dib">
      MySQL to PostgreSQL
    </a>
    <div class="flex-l items-center">
      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/post/" title="FAQ page">
              FAQ
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/project/" title="Project Methodology page">
              Project Methodology
            </a>
          </li>
          
        </ul>
      
      







  <a href="https://github.com/dimitri/pgloader" class="link-transition github link dib z-999 pt3 pt0-l mr2" title="Github link">
    <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

  </a>


    </div>
  </div>
</nav>

      <div class="tc-l pv4 pv6-l ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 white-90 mb0 lh-title">
          Project Methodology
        </h1>
        
          <h2 class="fw1 f5 f3-l white-80 measure-wide-l center mt3">
            “A goal without a plan is just a wish” — Antoine de Saint-Exupéry
          </h2>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="pa3 pa4-ns nested-copy-line-height nested-img">
  <main class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy mid-gray">

<p>A migration project may take a little more than a week-end, so you need to
consider it as a real project. Follow this methodology and it&rsquo;s all going to
be fine, I promise:</p>


<figure >
    
        <img src="/img/keep-calm-and-automate-all-the-things-13.png" />
    
    
    <figcaption>
        <h4>Keep Calm and Automate All the Things!</h4>
        
    </figcaption>
    
</figure>


<p>When migrating from MySQL to PostgreSQL, follow those steps:</p>

<ol>
<li>Setup your target PostgreSQL Architecture</li>
<li>Fork a Continuous Integration environment that uses PostgreSQL</li>
<li>Migrate the data over and over again every night, from production</li>
<li>As soon as the CI is all green using PostgreSQL, schedule the D-Day</li>
<li>Migrate without suprise and enjoy!
<br /></li>
</ol>

<h1 id="postgresql-architecture">PostgreSQL Architecture</h1>

<p>That needs to be done first. Setup your <em>High Availability</em> before doing
anything else. The goal is for both the service and the data to be highly
available, so first setup a fully automated <em>backup and restore</em> solution.</p>

<p>For that, use either <a href="http://www.pgbarman.org">pgbarman</a> or
<a href="http://pgbackrest.org">pgbackrest</a>, or maybe
<a href="https://github.com/wal-e/wal-e">WAL-e</a> if you want to use Amazon S3.
Consider its replacement <a href="https://github.com/wal-g/wal-g">WAL-G</a> too.</p>

<p>Don&rsquo;t roll it yourself. It&rsquo;s really easy to do it wrong, and what you want
is an all automated <strong>recovery</strong> solution. Go for that.</p>

<h1 id="primary-server-and-replicas">Primary server and replicas</h1>

<p>In PostgreSQL we chose to stop talking about slavery as being something
crucial to our daily lifes. So we setup High Availability with a <em>Primary</em>
server and a set of <em>Secondary</em> servers, also named <em>Standby</em> or <em>Replica</em>.</p>

<p>If you want to understand all the details about the setup, you can read the
whole PostgreSQL documentation about <a href="https://www.postgresql.org/docs/current/static/high-availability.html">High Availability, Load Balancing, and
Replication</a>
and then about <a href="https://www.postgresql.org/docs/current/static/logical-replication.html">Logical
Replication</a>.</p>

<p>The PostgreSQL documentation best in class, and patches that add or modify
PostgreSQL features are only accepted when they also update all the impacted
documentation. Which means that our documentation is always uptodate and
trustworthy. That&rsquo;s why you don&rsquo;t see much comments in there. If any.</p>

<p>If you&rsquo;re not sure about what to do now, setup a PostgreSQL Hot Standby
physical replica by following the steps at <a href="https://wiki.postgresql.org/wiki/Hot_Standby">Hot
Standby</a>. It looks more
complex than it is. All you need to do is :</p>

<ol>
<li>check your <code>postgresql.conf</code> to allow for replication</li>
<li>open replication privileges on the network in <code>pg_hba.conf</code></li>
<li>use <code>pg_basebackup</code> to have a remote copy of your <em>Primary</em> data</li>
<li>start your <em>Replica</em> with a setup that connects to the <em>Primary</em></li>
</ol>

<p>That&rsquo;s it really.</p>

<h1 id="mysql-row-based-replication">MySQL Row-Based Replication</h1>

<p>In MySQL it&rsquo;s possible to setup replication and still edit local data in
other tables in the Replica. This is a solid use-case for some
architectures. Of course, as soon as the replica has a different data set
than the Primary, then the solution doesn&rsquo;t provide High Availability. You
might still be interested into having a similar solution in PostgreSQL.</p>

<p>Starting with PostgreSQL 10 you can use <em>Logical Replication</em>. It&rsquo;s easy to
setup, as seen in the <a href="https://www.postgresql.org/docs/10/static/logical-replication-quick-setup.html">Logical Replication Quick
Setup</a>
part of the PostgreSQL documentation.</p>

<h1 id="ci-cd">CI/CD</h1>

<p>That&rsquo;s how we do it now right? It&rsquo;s all automated everywhere into a Jenkins
or a Travis setup, or something equivalent. Or even something better. Well
then, do the same thing for your migration project.</p>

<h1 id="nightly-data-migration">Nightly Data Migration</h1>

<p>Chances are that once your data migration script is tweaked for all the data
you&rsquo;ve seen through, some new data is going to show up in production that
will defeat your script.</p>

<p>To avoid data related surprises on the D-Day, just run the whole data
migration script for the production&rsquo;s data every night, for the whole
duration of the project. You will have such a track record of catering with
new data that you will fear no surprises. In a migration project, surprises
seldom are the good ones.</p>

<blockquote>
<p><em>“If it wasn&rsquo;t for bad luck, I wouldn&rsquo;t have no luck at all.”</em></p>

<p>Albert King, Born Under a Bad Sign</p>
</blockquote>

<h1 id="porting-the-code-from-mysql-to-postgresql">Porting the Code from MySQL to PostgreSQL</h1>

<p>Now that you have a CI/CD environment fresh with yesterday&rsquo;s production data
every morning, it&rsquo;s time to rewrite those MySQL queries for PostgreSQL.
There are a couple things to know when doing that:</p>

<ul>
<li><p>PostgreSQL likes JOINs</p>

<p>Yes that&rsquo;s right, you can actually have very fast running queries using
JOINs in PostgreSQL.</p></li>

<li><p>Quoting is different</p>

<p>In PostgreSQL we quote SQL identifiers using &ldquo;double quotes&rdquo; and literal
values using &lsquo;single quotes&rsquo;.</p></li>

<li><p><code>on duplicate key update</code> is written <code>on conflict do update</code></p>

<p>And it might even be <code>do nothing</code>, too.</p></li>

<li><p>See the <a href="/post">FAQ</a> section for more conversion hints.</p></li>
</ul>

<p>When you see differences in the SQL in between PostgreSQL and SQL, mostly it
is PostgreSQL following the SQL standard syntax.</p>
</main>
    <section class="flex-ns flex-wrap justify-around mt5">
      
    </section>
</article>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://mysqltopgsql.com/" >
    &copy; 2018 MySQL to PostgreSQL
  </a>
  







  <a href="https://github.com/dimitri/pgloader" class="link-transition github link dib z-999 pt3 pt0-l mr2" title="Github link">
    <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

  </a>


  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
